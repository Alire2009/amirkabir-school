<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø§Ù…ÛŒØ±Ú©Ø¨ÛŒØ±</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      margin: 0;
      direction: rtl;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color: #eee;
    }
    header {
      background: rgba(0,0,0,0.6);
      padding: 10px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    #loginArea, #app { display: none; }
    #loginArea.active { display: flex; justify-content: center; align-items: center; height: 100vh; }
    .login-box {
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      text-align: center;
      width: 300px;
    }
    .login-box input {
      width: 90%;
      margin: 8px 0;
      padding: 10px;
      border: none;
      border-radius: 10px;
    }
    .login-box button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: #4caf50;
      color: #fff;
      cursor: pointer;
    }
    nav {
      background: rgba(0,0,0,0.8);
      display: flex;
      gap: 10px;
      padding: 10px;
    }
    nav button {
      background: #2196f3;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
    }
    section { padding: 20px; display: none; }
    section.active { display: block; }
    .card {
      background: rgba(255,255,255,0.08);
      padding: 15px;
      border-radius: 15px;
      margin: 10px 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    input, textarea, select {
      border-radius: 8px;
      padding: 8px;
      margin: 5px 0;
      border: none;
    }
    button { transition: 0.3s; }
    button:hover { opacity: 0.85; }
  </style>
</head>
<body>
  <header>ğŸ“ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø§Ù…ÛŒØ±Ú©Ø¨ÛŒØ±</header>

  <!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
  <div id="loginArea" class="active">
    <div class="login-box">
      <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡</h2>
      <input id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
      <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
      <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
    </div>
  </div>

  <!-- Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø§ØµÙ„ÛŒ -->
  <div id="app">
    <nav>
      <button onclick="show('dashboard')">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
      <button onclick="show('news')">ğŸ“° Ø§Ø®Ø¨Ø§Ø±</button>
      <button onclick="show('gallery')">ğŸ–¼ï¸ Ú¯Ø§Ù„Ø±ÛŒ</button>
      <button onclick="show('poll')">ğŸ“Š Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ</button>
      <button onclick="show('attendance')">ğŸ“‹ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</button>
      <button onclick="show('grades')">ğŸ“‘ Ú©Ø§Ø±Ù†Ø§Ù…Ù‡</button>
      <button id="m-users" onclick="show('users')">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª</button>
      <button onclick="show('chat')">ğŸ’¬ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</button>
    </nav>

    <section id="dashboard" class="active">
      <h2>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
      <p id="userBar"></p>
      <div class="card">Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø¬Ø§Ù…Ø¹ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø§Ù…ÛŒØ±Ú©Ø¨ÛŒØ± Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸŒ¹</div>
    </section>

    <section id="news">
      <h2>Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡â€ŒÙ‡Ø§</h2>
      <div id="newsList"></div>
      <div id="newsForm" class="card"></div>
    </section>

    <section id="gallery">
      <h2>Ú¯Ø§Ù„Ø±ÛŒ ØªØµØ§ÙˆÛŒØ±</h2>
      <div id="galleryList"></div>
      <div id="galleryForm" class="card"></div>
    </section>

    <section id="poll">
      <h2>Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ</h2>
      <div id="pollContent"></div>
    </section>

    <section id="attendance">
      <h2>Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h2>
      <div id="attendContent"></div>
    </section>

    <section id="grades">
      <h2>Ú©Ø§Ø±Ù†Ø§Ù…Ù‡</h2>
      <div id="gradesContent"></div>
    </section>

    <section id="users">
      <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
      <div id="usersContent"></div>
    </section>

    <section id="chat">
      <h2>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h2>
      <div id="chatList"></div>
      <div id="chatForm" class="card"></div>
    </section>
  </div>

  <script>
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    let state = JSON.parse(localStorage.getItem("amirkabir_v3") || "{}");
    if(!state.users){
      state = {
        users:{
          "admin":{password:"1234",role:"admin",name:"Ù…Ø¯ÛŒØ±"},
          "teacher":{password:"abcd",role:"teacher",name:"Ù…Ø¹Ù„Ù…"},
          "student":{password:"1111",role:"student",name:"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²"},
          "student2":{password:"2222",role:"student",name:"Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Û²"}
        },
        news:[], gallery:[], poll:{q:"Ø§Ø² Ù…Ø¯Ø±Ø³Ù‡ Ø±Ø§Ø¶ÛŒ Ù‡Ø³ØªÛŒØ¯ØŸ",yes:0,no:0},
        attendance:{}, grades:{}, chat:[]
      };
    }
    let currentUser=null;

    function save(){ localStorage.setItem("amirkabir_v3", JSON.stringify(state)); }

    // Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ÙˆØ±ÙˆØ¯ÛŒ (Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ â†’ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ trimØŒ lowercase)
    function normalizeInput(s){
      if(!s) return "";
      s = String(s).trim();
      const persian = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];
      const arabic  = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
      for(let i=0;i<10;i++){
        s = s.split(persian[i]).join(String(i));
        s = s.split(arabic[i]).join(String(i));
      }
      return s;
    }

    // ÙˆØ±ÙˆØ¯
    function login(){
      let rawUser=document.getElementById("username").value;
      let rawPass=document.getElementById("password").value;
      let uNorm=normalizeInput(rawUser).toLowerCase();
      let pNorm=normalizeInput(rawPass);
      let userKey=Object.keys(state.users).find(k=>k.toLowerCase()===uNorm);
      if(!userKey){ alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯"); return; }
      let stored=normalizeInput(state.users[userKey].password);
      if(stored===pNorm){
        currentUser={username:userKey,role:state.users[userKey].role,name:state.users[userKey].name};
        document.getElementById("loginArea").style.display="none";
        document.getElementById("app").style.display="block";
        document.getElementById("userBar").textContent=`${currentUser.name} (${currentUser.role})`;
        if(currentUser.role!=="admin") document.getElementById("m-users").style.display="none";
        renderAll();
      } else alert("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");
    }

    // ØªØºÛŒÛŒØ± ØµÙØ­Ù‡
    function show(id){
      document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Ø±Ù†Ø¯Ø± Ú©Ù„ Ø¨Ø®Ø´â€ŒÙ‡Ø§
    function renderAll(){ renderNews(); renderGallery(); renderPoll(); renderAttendance(); renderGrades(); renderUsers(); renderChat(); }

    // --- Ø§Ø®Ø¨Ø§Ø±
    function renderNews(){
      let list=document.getElementById("newsList");
      list.innerHTML=state.news.map(n=>`<div class="card">${n}</div>`).join("");
      let form=document.getElementById("newsForm");
      form.innerHTML="";
      if(currentUser.role!=="student"){
        form.innerHTML=`<input id="newNews" placeholder="Ø®Ø¨Ø± Ø¬Ø¯ÛŒØ¯"><button onclick="addNews()">Ø§ÙØ²ÙˆØ¯Ù†</button>`;
      }
    }
    function addNews(){ let t=document.getElementById("newNews").value.trim(); if(t){state.news.push(t); save(); renderNews();} }

    // --- Ú¯Ø§Ù„Ø±ÛŒ
    function renderGallery(){
      let list=document.getElementById("galleryList");
      list.innerHTML=state.gallery.map(u=>`<img src="${u}" style="max-width:150px;margin:5px;border-radius:10px">`).join("");
      let form=document.getElementById("galleryForm");
      form.innerHTML="";
      if(currentUser.role!=="student"){
        form.innerHTML=`<input id="newImg" placeholder="Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ±"><button onclick="addImg()">Ø§ÙØ²ÙˆØ¯Ù†</button>`;
      }
    }
    function addImg(){ let u=document.getElementById("newImg").value.trim(); if(u){state.gallery.push(u); save(); renderGallery();} }

    // --- Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ
    function renderPoll(){
      let p=state.poll;
      let div=document.getElementById("pollContent");
      div.innerHTML=`<div class="card"><b>${p.q}</b><br>
        Ø¨Ù„Ù‡: ${p.yes} / Ø®ÛŒØ±: ${p.no}<br>
        <button onclick="vote('yes')">Ø¨Ù„Ù‡</button> <button onclick="vote('no')">Ø®ÛŒØ±</button></div>`;
    }
    function vote(ans){ state.poll[ans]++; save(); renderPoll(); }

    // --- Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨
    function renderAttendance(){
      let div=document.getElementById("attendContent");
      if(currentUser.role==="teacher"||currentUser.role==="admin"){
        div.innerHTML=Object.keys(state.users).filter(u=>state.users[u].role==="student")
          .map(s=>`<label><input type="checkbox" onchange="markAttend('${s}',this.checked)" ${state.attendance[s]?"checked":""}> ${s}</label>`).join("<br>");
      } else {
        div.innerHTML=state.attendance[currentUser.username]?"Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² Ø­Ø§Ø¶Ø± Ù‡Ø³ØªÛŒØ¯ âœ…":"ØºØ§ÛŒØ¨ âŒ";
      }
    }
    function markAttend(s,val){ state.attendance[s]=val; save(); }

    // --- Ú©Ø§Ø±Ù†Ø§Ù…Ù‡
    function renderGrades(){
      let div=document.getElementById("gradesContent");
      if(currentUser.role==="student"){
        let g=state.grades[currentUser.username]||{};
        div.innerHTML=Object.keys(g).map(sub=>`<div>${sub}: ${g[sub]}</div>`).join("")||"Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡";
      } else {
        div.innerHTML=Object.keys(state.users).filter(u=>state.users[u].role==="student")
          .map(s=>`<div class="card"><b>${s}</b><br>
          <input id="g_${s}_math" placeholder="Ø±ÛŒØ§Ø¶ÛŒ" value="${(state.grades[s]||{}).math||""}">
          <input id="g_${s}_sci" placeholder="Ø¹Ù„ÙˆÙ…" value="${(state.grades[s]||{}).sci||""}">
          <button onclick="saveGrade('${s}')">Ø«Ø¨Øª</button></div>`).join("");
      }
    }
    function saveGrade(s){
      state.grades[s]={math:document.getElementById(`g_${s}_math`).value,sci:document.getElementById(`g_${s}_sci`).value};
      save(); renderGrades();
    }

    // --- Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    function renderUsers(){
      let div=document.getElementById("usersContent");
      if(currentUser.role!=="admin"){div.innerHTML="Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯"; return;}
      div.innerHTML=Object.keys(state.users).map(u=>`<div>${u} (${state.users[u].role})</div>`).join("")+
      `<hr><input id="nu" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ"><input id="np" placeholder="Ø±Ù…Ø²"><select id="nr">
        <option value="student">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</option><option value="teacher">Ù…Ø¹Ù„Ù…</option><option value="admin">Ù…Ø¯ÛŒØ±</option></select>
        <button onclick="addUser()">Ø§ÙØ²ÙˆØ¯Ù†</button>`;
    }
    function addUser(){
      let u=document.getElementById("nu").value.trim();
      let p=document.getElementById("np").value.trim();
      let r=document.getElementById("nr").value;
      if(u&&p){state.users[u]={password:p,role:r,name:u}; save(); renderUsers();}
    }

    // --- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
    function renderChat(){
      let list=document.getElementById("chatList");
      list.innerHTML=state.chat.map(c=>`<div class="card"><b>${c.user}:</b> ${c.text}</div>`).join("");
      let form=document.getElementById("chatForm");
      form.innerHTML=`<input id="msg"><button onclick="sendMsg()">Ø§Ø±Ø³Ø§Ù„</button>`;
    }
    function sendMsg(){ let t=document.getElementById("msg").value.trim(); if(t){state.chat.push({user:currentUser.name,text:t}); save(); renderChat();} }
  </script>
</body>
</html>
